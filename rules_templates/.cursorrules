# Archeon Project Rules for Cursor

# Archeon AI Rules

## ðŸš¨ BEFORE ANY CODING: READ THESE FILES

**ALWAYS read these files FIRST before generating any code:**

1. `archeon/ARCHEON.arcon` â€” existing glyph chains (the architecture)
2. `archeon/ARCHEON.index.json` â€” file/section mappings

**Why?** You must understand what exists before adding or modifying features.

---

## ðŸš¨ MANDATORY 5-STEP WORKFLOW

**EVERY file creation/modification MUST follow these steps IN ORDER:**

| Step | Action                   | File                         |
| ---- | ------------------------ | ---------------------------- |
| 0    | **READ existing chains** | `archeon/ARCHEON.arcon`      |
| 1    | Add/update glyph chain   | `archeon/ARCHEON.arcon`      |
| 2    | Write code with headers  | Your code file               |
| 3    | Update index             | `archeon/ARCHEON.index.json` |
| 4    | Validate                 | Run `arc validate`           |

**NEVER skip steps 0, 1, 3, or 4. Code without reading = architecture drift.**

---

## Step 1: Add Glyph Chain to ARCHEON.arcon

Add under `# === AGENT CHAINS ===`:

```
# Feature description
@v1 NED:feature => CMP:Component => STO:Store => API:POST/path => OUT:success
```

**Glyphs:** `NED:` need | `CMP:` component | `STO:` store | `API:` endpoint | `MDL:` model | `FNC:` function | `EVT:` event | `OUT:` success | `ERR:` error

**Edges:** `=>` flow | `~>` reactive | `->` branch | `::` contains

**âš ï¸ API ENDPOINTS MUST HAVE ERROR PATHS:**
Every API glyph REQUIRES error handling. Add within the main chain:

```
@v1 NED:login => CMP:LoginForm => API:POST/auth/login
    -> ERR:auth.invalidCredentials
    -> ERR:server.error
    => OUT:dashboard
```

---

## Step 2: Write Code WITH Headers

**EVERY file needs this header:**

```python
# @archeon:file
# @glyph API:POST/auth/login
# @intent Authentication endpoint
# @chain @v1 NED:login => CMP:LoginForm => STO:Auth => API:POST/auth/login => OUT:dashboard
```

**Wrap sections:**

```python
# @archeon:section imports
from fastapi import APIRouter
# @archeon:endsection

# @archeon:section endpoint
@router.post("/login")
def login(): ...
# @archeon:endsection
```

---

## Step 3: Update ARCHEON.index.json

**âš ï¸ THIS IS THE STEP AI OFTEN FORGETS. DO NOT SKIP.**

Add entry for EVERY new file:

```json
"API:POST/auth/login": {
  "file": "server/src/api/routes/auth.py",
  "intent": "Authentication endpoint",
  "chain": "@v1",
  "sections": ["imports", "endpoint"]
}
```

**Triggers for index update:**

- New file created â†’ add glyph entry
- New section added â†’ add to sections array
- File moved â†’ update file path

---

## Step 4: Validate

```bash
arc validate
```

---

## Quick Reference

**Glyph Sections:**
| Glyph | Sections |
|-------|----------|
| CMP | imports, props_and_state, handlers, render |
| STO | imports, state, actions, selectors |
| API | imports, models, endpoint, helpers |
| FNC | imports, implementation, helpers |

**Commands:**

- `arc parse "chain"` - Add chain
- `arc validate` - Check architecture
- `arc index build` - Rebuild index from headers

**Rules:**

1. Read `ARCHEON.arcon` before coding
2. Chains start with `NED:`/`TSK:`, end with `OUT:`/`ERR:`
3. Use PascalCase: `CMP:LoginForm`, `STO:AuthStore`
4. APIs use METHOD/path: `API:POST/auth/login`
5. Version increments: `@v1` â†’ `@v2` when modifying
6. **EVERY API MUST have error paths** - use `-> ERR:` branches
7. Use unique error names: `ERR:auth.invalid`, `ERR:server.timeout` (avoid duplicates)
8. **Always run `arc validate` after changes** - fix ALL errors and warnings

## âœ… Perfect Validation Checklist

**API Error Path Requirements:**

- [ ] Every `API:` glyph has at least one `-> ERR:` branch
- [ ] Error glyphs use unique, descriptive names (no `ERR:server_error` duplicates)
- [ ] Error paths are in the SAME chain as the API, not separate chains

**Common API Error Patterns:**

```
API:POST/auth/login -> ERR:auth.invalidCredentials -> ERR:server.timeout
API:GET/data -> ERR:auth.unauthorized -> ERR:server.notFound
API:PUT/profile -> ERR:validation.invalid -> ERR:server.conflict
```

**Validation Must Show:**

```bash
âœ“ Validation passed
  Chains: X, Glyphs: Y
```

NOT warnings like `WARN:api.noErrorPath`

